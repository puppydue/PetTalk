{% extends "base.html" %}
{% block title %}Danh sÃ¡ch sá»± kiá»‡n{% endblock %}
{% block content %}

<div class="event-list">

  <div class="create-event-wrapper">
    <a href="{% url 'tao_su_kien' %}" class="create-event-btn"> Táº¡o sá»± kiá»‡n má»›i</a>
  </div>

  <h2> Danh sÃ¡ch sá»± kiá»‡n</h2>

  <!-- ğŸ‘¤ Sá»° KIá»†N Cá»¦A TÃ”I --><section class="my-events">
    <h3> Sá»± kiá»‡n cá»§a tÃ´i</h3>

    {% if su_kien_cua_toi %}
    <div class="carousel-wrapper"> {# Bá» class 'has-scroll' á»Ÿ Ä‘Ã¢y #}
      <button class="carousel-btn left" onclick="scrollCarousel('myEventsCarousel', -1)">&#10094;</button>

      <div class="carousel-container" id="myEventsCarousel">
        {% for e in su_kien_cua_toi %}
          <div class="event-card">
            {% if e.image %}
              <img src="{{ e.image.url }}" alt="{{ e.title }}">
            {% endif %}
            <h4>{{ e.title }}</h4>
            <p>{{ e.description|truncatechars:80 }}</p>
            <p><strong>Thá»i gian:</strong> {{ e.date|date:"d/m/Y H:i" }}</p>
            <p><strong>ğŸ‘¥ Sá»‘ lÆ°á»£ng:</strong> {{ e.participants.count }} / {{ e.capacity|default:"âˆ" }}</p>


            <div class="status-wrapper"> {# ÄÃ£ thÃªm margin-top qua CSS #}
              <strong>Tráº¡ng thÃ¡i:</strong>
              {% if e.status == 'approved' %}
                <span class="status-badge status-approved"> ÄÃ£ phÃª duyá»‡t</span>
              {% elif e.status == 'rejected' %}
                <span class="status-badge status-rejected"> Bá»‹ tá»« chá»‘i</span>
              {% else %}
                <span class="status-badge status-pending"> Chá» phÃª duyá»‡t</span>
              {% endif %}
            </div>

            {% if not e.is_past %}
              <div class="event-actions">
                  <div>
                    <a href="{% url 'chinh_sua_su_kien' e.id %}" class="edit-btn">Chá»‰nh sá»­a</a>
                    <a href="{% url 'xoa_su_kien' e.id %}" class="cancel-btn">XÃ³a</a>
                  </div>

                  {% if e.status == 'approved' %}
                    <div style="margin-top: 10px;">
                      <a href="{% url 'danh_sach_nguoi_dang_ky' e.id %}" class="view-btn">Xem danh sÃ¡ch ngÆ°á»i tham gia</a>
                    </div>
                  {% endif %}
                </div>

            {% else %}
              <div class="event-ended"> Sá»± kiá»‡n Ä‘Ã£ káº¿t thÃºc</div>
            {% endif %}
          </div>
        {% endfor %}
      </div>

      <button class="carousel-btn right" onclick="scrollCarousel('myEventsCarousel', 1)">&#10095;</button>
      {# Dáº¥u hiá»‡u trÆ°á»£t má»›i #}
      <div class="carousel-fade left-fade"></div>
      <div class="carousel-fade right-fade"></div>
    </div>
    {% else %}
      <p>Báº¡n chÆ°a táº¡o sá»± kiá»‡n nÃ o.</p>
    {% endif %}
  </section>

  <!-- ğŸŒ DANH SÃCH Sá»° KIá»†N --><section class="community-events">
    <h3> Danh sÃ¡ch sá»± kiá»‡n</h3>

    {% if danh_sach_su_kien %}
    <div class="event-grid">
      {% for e in danh_sach_su_kien %}
        <div class="event-card">
          {% if e.image %}
            <img src="{{ e.image.url }}" alt="{{ e.title }}">
          {% endif %}
          <h4>{{ e.title }}</h4>

          {# ÄÃƒ Cáº¬P NHáº¬T THEO YÃŠU Cáº¦U #}
          <p class="creator-highlight">
            ğŸ‘¤ Táº¡o bá»Ÿi: <span class="highlight-username">{{ e.creator.username }}</span>
          </p>

          <p>{{ e.description|truncatechars:80 }}</p>
          <p><strong>ğŸ“ Äá»‹a Ä‘iá»ƒm:</strong> {{ e.location }}</p>
          <p><strong>ğŸ•“ Thá»i gian:</strong> {{ e.date|date:"d/m/Y H:i" }}</p>
          <p>
              <strong>ğŸ‘¥ Sá»‘ lÆ°á»£ng:</strong>
              {{ e.participants.count }} / {{ e.capacity|default:"âˆ" }} ngÆ°á»i tham gia
          </p>


          {% if e.is_past %}
            <div class="event-ended">ğŸ•“ Sá»± kiá»‡n Ä‘Ã£ káº¿t thÃºc</div>
          {% else %}
            {% if e.creator == user %}
              <a href="{% url 'danh_sach_nguoi_dang_ky' e.id %}" class="view-btn"> Xem danh sÃ¡ch ngÆ°á»i tham gia</a>
            {% elif user in e.participants.all %}
              <a href="{% url 'huy_dang_ky_tham_gia' e.id %}" class="cancel-btn"> Há»§y ÄK</a>
            {% else %}
              <a href="{% url 'dang_ky_tham_gia' e.id %}" class="join-btn"> Tham gia</a>
            {% endif %}
          {% endif %}
        </div>
      {% endfor %}
    </div>
    {% else %}
      <p>ChÆ°a cÃ³ sá»± kiá»‡n nÃ o Ä‘Æ°á»£c phÃª duyá»‡t.</p>
    {% endif %}
  </section>
</div>

<!-- âœ… CSS --><style>
/* CÃ¡c CSS cÅ© giá»¯ nguyÃªn, chá»‰ chá»‰nh sá»­a/thÃªm nhá»¯ng pháº§n dÆ°á»›i Ä‘Ã¢y */

.event-list {
  width: 100%;
  max-width: 100%;
  margin: 0;
  padding: 20px;
  background: none;
  border: none;
  box-sizing: border-box;
}

/* ====== CAROUSEL (ÄÃƒ Cáº¬P NHáº¬T) ====== */
.carousel-wrapper {
  position: relative;
  margin-bottom: 40px;
  /* Bá» display flex & justify-content */
  overflow: hidden; /* Quan trá»ng Ä‘á»ƒ áº©n pháº§n nÃºt bá»‹ trÃ n ra */
  padding: 0 50px; /* ThÃªm padding Ä‘á»ƒ nÃºt bÃªn trong cÃ³ chá»— Ä‘á»©ng */
}

/* THAY THáº¾ HIá»†U á»¨NG Má»œ CÅ¨ */
.carousel-fade {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 50px; /* Báº±ng vá»›i padding cá»§a carousel-wrapper */
    pointer-events: none; /* Cho phÃ©p click xuyÃªn qua */
    z-index: 10;
}
.left-fade {
    left: 0;
    background: linear-gradient(to right, #fff8ed, rgba(255, 248, 237, 0)); /* MÃ u ná»n cá»§a body */
}
.right-fade {
    right: 0;
    background: linear-gradient(to left, #fff8ed, rgba(255, 248, 237, 0)); /* MÃ u ná»n cá»§a body */
}

.carousel-container {
  display: flex;
  overflow-x: auto;
  scroll-behavior: smooth;
  gap: 25px;
  padding: 10px 0; /* Padding 2 bÃªn váº«n lÃ  0 Ä‘á»ƒ carousel-fade hoáº¡t Ä‘á»™ng */
  scrollbar-width: none;
}
.carousel-container::-webkit-scrollbar { display: none; }

.carousel-btn {
  background: #ffb84d;
  border: none;
  color: white;
  font-size: 20px;
  padding: 8px 12px;
  border-radius: 50%;
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);

  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 11; /* NÃºt pháº£i cao hÆ¡n lá»›p fade */
}
.carousel-btn:hover {
  background: #ff9800;
  transform: translateY(-50%) scale(1.1);
}

.left { left: 5px; } /* Vá»‹ trÃ­ so vá»›i carousel-wrapper (Ä‘Ã£ cÃ³ padding) */
.right { right: 5px; }


/* ====== KHUNG TRáº NG THÃI ====== */
.status-wrapper {
  margin-top: 15px; /* THAY Äá»”I: TÄƒng khoáº£ng cÃ¡ch tá»« ná»™i dung trÃªn */
  font-size: 14px;
  display: flex; /* DÃ¹ng flex Ä‘á»ƒ cÄƒn chá»‰nh */
  align-items: center;
  gap: 8px; /* Khoáº£ng cÃ¡ch giá»¯a "Tráº¡ng thÃ¡i:" vÃ  badge */
}
.status-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 20px;
  font-weight: 600;
  font-size: 13px;
  white-space: nowrap; /* Äáº£m báº£o khÃ´ng xuá»‘ng dÃ²ng */
}
.status-badge.status-approved {
  background: #dcfce7;
  color: #166534;
}
.status-badge.status-pending {
  background: #fef9c3;
  color: #713f12;
}
.status-badge.status-rejected {
  background: #fee2e2;
  color: #991b1b;
}

/* ====== KHUNG TÃŠN USER (ÄÃƒ Cáº¬P NHáº¬T THEO YÃŠU Cáº¦U) ====== */
.creator-highlight {
  font-size: 14px;
  color: #475569; /* MÃ u chá»¯ xÃ¡m cho "Táº¡o bá»Ÿi:" */
  margin-bottom: 6px;
  display: flex; /* DÃ¹ng flex Ä‘á»ƒ cÄƒn chá»‰nh */
  align-items: center; /* CÄƒn giá»¯a "Táº¡o bá»Ÿi" vÃ  badge */
  gap: 6px; /* Khoáº£ng cÃ¡ch giá»¯a text vÃ  badge */
}
.creator-highlight .highlight-username {
  /* Bá» display: inline-flex vÃ  cÃ¡c thuá»™c tÃ­nh liÃªn quan Ä‘áº¿n icon */
  background: #e0f2fe; /* Ná»n xanh nháº¡t, ná»•i báº­t hÆ¡n */
  color: #003459; /* Chá»¯ xanh Ä‘áº­m */
  padding: 4px 10px;
  border-radius: 8px;
  font-weight: 600;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* BÃ³ng nháº¹ */
  font-size: 13px; /* Cho tÃªn user nhá» hÆ¡n 1 chÃºt cho Ä‘áº¹p */
  display: inline-block;
}


/* ====== CARD ====== */
.event-card {
  flex: 0 0 280px;
  background: #fffef7;
  border-radius: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  padding: 18px;
  text-align: left;
  border: 1.5px solid #ffe082;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-height: 350px;
}
.event-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
}
.event-card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
  border-radius: 12px;
  margin-bottom: 10px;
}

/* ====== BUTTONS ====== */
.event-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 15px; /* THAY Äá»”I: TÄƒng khoáº£ng cÃ¡ch tá»« ná»™i dung trÃªn */
}
.edit-btn, .join-btn, .view-btn, .cancel-btn, .delete-btn {
  display: inline-block;
  font-size: 14px;
  font-weight: 600;
  border-radius: 8px;
  text-decoration: none;
  transition: 0.25s;
  padding: 8px 14px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  width: fit-content;
  text-align: center; /* CÄƒn giá»¯a chá»¯ trong nÃºt */
}
.edit-btn {
  background: linear-gradient(135deg, #ffb84d, #ff9800);
  color: white;
}
.delete-btn {
  background: linear-gradient(135deg, #b71c1c, #f44336);
  color: white;
}
.join-btn, .view-btn { background: #003459; color: white; }
.view-btn { background: linear-gradient(135deg, #6ba6ff, #1e88e5); }
.cancel-btn {
  background: linear-gradient(135deg, #ff6b6b, #ff4757);
  color: white;
}
.edit-btn:hover, .join-btn:hover, .view-btn:hover, .cancel-btn:hover, .delete-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 10px rgba(0,0,0,0.2);
}

/* ====== GRID ====== */
.event-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 16px;
  margin-top: 10px;
}

/* ====== CREATE BUTTON ====== */
.create-event-wrapper {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 10px;
}
.create-event-btn {
  background: linear-gradient(135deg, #4CAF50, #2E7D32);
  color: white;
  font-weight: 600;
  padding: 10px 18px;
  border-radius: 10px;
  text-decoration: none;
  transition: 0.3s;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
.create-event-btn:hover {
  background: linear-gradient(135deg, #43A047, #1B5E20);
  transform: translateY(-2px);
}
.event-ended {
  text-align: center;
  font-weight: 600;
  color: #666;
  background: #f9f9f9;
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
  border: 1px dashed #bbb;
}
</style>

<script>
function scrollCarousel(carouselId, direction) {
  const container = document.getElementById(carouselId);
  const scrollAmount = container.offsetWidth * 0.8;
  container.scrollBy({ left: scrollAmount * direction, behavior: 'smooth' });
}
</script>

{% endblock %}

