{% extends "base.html" %}
{% block title %}Danh sÃ¡ch sá»± kiá»‡n{% endblock %}
{% block content %}
{% if messages %}
  {% for message in messages %}
    <div class="center-toast {{ message.tags }}">
      {{ message }}
    </div>
  {% endfor %}

  <script>
    // Tá»± Ä‘á»™ng áº©n sau 3 giÃ¢y
    setTimeout(() => {
      document.querySelectorAll('.center-toast').forEach(msg => {
        msg.style.opacity = '0';
        msg.style.transform = 'translate(-50%, -40%) scale(0.9)';
      });
    }, 3000);
  </script>

  <style>
    .center-toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      background: #4caf50; /* mÃ u xanh thÃ nh cÃ´ng */
      color: white;
      font-weight: 600;
      padding: 14px 26px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.25);
      z-index: 9999;
      min-width: 360px;
      transition: all 0.8s ease;
      animation: fadeInPop 0.4s ease-out;
    }

    .center-toast.error { background: #f44336; }
    .center-toast.warning { background: #ff9800; }

    @keyframes fadeInPop {
      from {
        opacity: 0;
        transform: translate(-50%, -60%) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }
  </style>
{% endif %}


<div class="event-list">
  <h2>ğŸ‰ Danh sÃ¡ch sá»± kiá»‡n</h2>

 <!-- ğŸ§â€â™‚ï¸ Sá»° KIá»†N Cá»¦A TÃ”I -->
<section class="my-events">
  <h3>ğŸ§â€â™‚ï¸ Sá»± kiá»‡n cá»§a tÃ´i</h3>
  {% if su_kien_cua_toi %}
    <div class="event-grid">
      {% for e in su_kien_cua_toi %}
        <div class="event-card my-event">
          {% if e.image %}
            <img src="{{ e.image.url }}" alt="{{ e.title }}">
          {% endif %}
          <h4>{{ e.title }}</h4>
          <p>{{ e.description|truncatechars:80 }}</p>
          <p><strong>Thá»i gian:</strong> {{ e.date|date:"d/m/Y H:i" }}</p>
          <p><strong>Tráº¡ng thÃ¡i:</strong>
            {% if e.status == 'pending' %}
              <span class="status pending">â³ Chá» phÃª duyá»‡t</span>
            {% elif e.status == 'approved' %}
              <span class="status approved">âœ… ÄÃ£ phÃª duyá»‡t</span>
            {% else %}
              <span class="status rejected">âŒ Tá»« chá»‘i</span>
            {% endif %}
          </p>

          {% if e.status == 'pending' %}
            <a href="{% url 'chinh_sua_su_kien' e.id %}" class="edit-btn">âœï¸ Chá»‰nh sá»­a sá»± kiá»‡n</a>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>ğŸ’¤ Báº¡n chÆ°a táº¡o sá»± kiá»‡n nÃ o.</p>
  {% endif %}
</section>


  <!-- ğŸŒ DANH SÃCH Sá»° KIá»†N -->
<section class="community-events">
  <h3>ğŸŒ Danh sÃ¡ch sá»± kiá»‡n</h3>

  <!-- Hiá»ƒn thá»‹ thÃ´ng bÃ¡o náº¿u cÃ³ ?success hoáº·c ?cancel -->
  {% if request.GET.success %}
    <div id="flash-message" class="flash-message success">
      âœ… Báº¡n Ä‘Ã£ Ä‘Äƒng kÃ½ tham gia sá»± kiá»‡n thÃ nh cÃ´ng!
    </div>
  {% elif request.GET.cancel %}
    <div id="flash-message" class="flash-message warning">
      âŒ Báº¡n Ä‘Ã£ há»§y Ä‘Äƒng kÃ½ sá»± kiá»‡n thÃ nh cÃ´ng!
    </div>
  {% endif %}

  {% if danh_sach_su_kien %}
    <div class="event-grid">
      {% for e in danh_sach_su_kien %}
        <div class="event-card">
          {% if e.image %}
            <img src="{{ e.image.url }}" alt="{{ e.title }}">
          {% endif %}
          <h4>{{ e.title }}</h4>
          <p>{{ e.description|truncatechars:80 }}</p>
          <p><strong>Äá»‹a Ä‘iá»ƒm:</strong> {{ e.location }}</p>
          <p><strong>Thá»i gian:</strong> {{ e.date|date:"d/m/Y H:i" }}</p>

          <!-- âœ… Kiá»ƒm tra quyá»n / tráº¡ng thÃ¡i -->
          {% if e.creator == user %}
            <a href="{% url 'danh_sach_nguoi_dang_ky' e.id %}" class="view-btn">ğŸ‘¥ Xem danh sÃ¡ch ngÆ°á»i Ä‘Äƒng kÃ½</a>
          {% elif user in e.participants.all %}
            <a href="{% url 'huy_dang_ky_tham_gia' e.id %}" class="cancel-btn">âŒ Há»§y Ä‘Äƒng kÃ½</a>

          {% else %}
            <a href="{% url 'dang_ky_tham_gia' e.id %}" class="join-btn">ğŸ¾ ÄÄƒng kÃ½ tham gia</a>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>ChÆ°a cÃ³ sá»± kiá»‡n nÃ o Ä‘Æ°á»£c phÃª duyá»‡t.</p>
  {% endif %}
</section>

<!-- Popup message hiá»‡u á»©ng -->
<script>
  setTimeout(() => {
    const msg = document.getElementById("flash-message");
    if (msg) msg.style.display = "none";
  }, 3500);
</script>

<style>
  .flash-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #4caf50;
    color: white;
    padding: 14px 28px;
    border-radius: 10px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    z-index: 1000;
    animation: fadeInOut 3.5s ease forwards;
    text-align: center;
    min-width: 360px;
  }

  .flash-message.warning {
    background: #ff9800;
  }

  @keyframes fadeInOut {
    0% { opacity: 0; transform: translate(-50%, -60%); }
    10%, 90% { opacity: 1; transform: translate(-50%, -50%); }
    100% { opacity: 0; transform: translate(-50%, -40%); }
  }
</style>


</div>

<style>
.event-list {
  padding: 20px;
  background-color: #fff8e1;
  border-radius: 16px;
}
.event-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px;
  margin-top: 10px;
}
.event-card {
  background: #fff;
  border-radius: 12px;
  padding: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  transition: 0.3s;
}
.event-card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
  border-radius: 10px;
  margin-bottom: 10px;
}
.event-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
.status.pending { color: #ff9800; font-weight: 600; }
.status.approved { color: #4caf50; font-weight: 600; }
.status.rejected { color: #f44336; font-weight: 600; }
.join-btn {
  display: inline-block;
  background: #003459;
  color: #fff;
  padding: 6px 10px;
  border-radius: 8px;
  text-decoration: none;
  font-size: 14px;
}
.join-btn:hover {
  background: #0056a3;
}

.edit-btn {
  display: inline-block;
  background: linear-gradient(135deg, #ffb84d, #ff9800);
  color: white;
  font-weight: 600;
  padding: 8px 14px;
  border-radius: 8px;
  text-decoration: none;
  transition: 0.3s;
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}
.edit-btn:hover {
  background: linear-gradient(135deg, #ffa726, #fb8c00);
  transform: translateY(-2px);
}

</style>

<style>
.cancel-btn {
  display: inline-block;
  background: linear-gradient(135deg, #ff6b6b, #ff4757);
  color: #fff;
  padding: 7px 14px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  text-decoration: none;
  border: none;
  transition: all 0.25s ease;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}
.cancel-btn:hover {
  background: linear-gradient(135deg, #ff4757, #e84118);
  transform: translateY(-2px);
  box-shadow: 0 5px 12px rgba(0,0,0,0.25);
}
</style>



{% endblock %}
