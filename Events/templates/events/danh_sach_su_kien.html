{% extends "base.html" %}
{% block title %}Danh s√°ch s·ª± ki·ªán{% endblock %}
{% block content %}

{% if messages %}
  {% for message in messages %}
    <div class="center-toast {{ message.tags }}">
      {{ message }}
    </div>
  {% endfor %}
  <script>
    setTimeout(() => {
      document.querySelectorAll('.center-toast').forEach(msg => {
        msg.style.opacity = '0';
        msg.style.transform = 'translate(-50%, -40%) scale(0.9)';
      });
    }, 3000);
  </script>
  <style>
    .center-toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      background: #4caf50;
      color: white;
      font-weight: 600;
      padding: 14px 26px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.25);
      z-index: 9999;
      min-width: 360px;
      transition: all 0.8s ease;
      animation: fadeInPop 0.4s ease-out;
    }
    .center-toast.error { background: #f44336; }
    .center-toast.warning { background: #ff9800; }
    @keyframes fadeInPop {
      from { opacity: 0; transform: translate(-50%, -60%) scale(0.9); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
  </style>
{% endif %}

<div class="event-list">

  <div class="create-event-wrapper">
    <a href="{% url 'tao_su_kien' %}" class="create-event-btn">‚ûï T·∫°o s·ª± ki·ªán m·ªõi</a>
  </div>

  <h2>üéâ Danh s√°ch s·ª± ki·ªán</h2>

  <!-- üë§ S·ª∞ KI·ªÜN C·ª¶A T√îI -->
  <section class="my-events">
    <h3>üë§ S·ª± ki·ªán c·ªßa t√¥i</h3>

    {% if su_kien_cua_toi %}
    <div class="carousel-wrapper">
      <button class="carousel-btn left" onclick="scrollLeft()">&#10094;</button>

      <div class="carousel-container" id="myEventsCarousel">
        {% for e in su_kien_cua_toi %}
            <div class="event-card">
                {% if e.image %}
            <img src="{{ e.image.url }}" alt="{{ e.title }}">
        {% endif %}
        <h4>{{ e.title }}</h4>
        <p>{{ e.description|truncatechars:80 }}</p>
        <p><strong>Th·ªùi gian:</strong> {{ e.date|date:"d/m/Y H:i" }}</p>
        <p>
            <strong>Tr·∫°ng th√°i:</strong>
            {% if e.status == 'approved' %}
                ‚úÖ ƒê√£ ph√™ duy·ªát
            {% else %}
                ‚è≥ Ch·ªù ph√™ duy·ªát
            {% endif %}
        </p>

        <div class="event-actions">
            <a href="{% url 'chinh_sua_su_kien' e.id %}" class="edit-btn">üîß Ch·ªânh s·ª≠a</a>

            {% if e.status == 'approved' %}
                <a href="{% url 'danh_sach_nguoi_dang_ky' e.id %}" class="view-btn">üë• Xem danh s√°ch ng∆∞·ªùi ƒëƒÉng k√Ω</a>
            {% endif %}
        </div>
      </div>
    {% endfor %}

      </div>

      <button class="carousel-btn right" onclick="scrollRight()">&#10095;</button>
    </div>
    {% else %}
      <p>B·∫°n ch∆∞a t·∫°o s·ª± ki·ªán n√†o.</p>
    {% endif %}
  </section>

  <style>
  /* ====== CAROUSEL ====== */
  .carousel-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 40px;
  }
  .carousel-container {
    display: flex;
    overflow-x: auto;
    scroll-behavior: smooth;
    gap: 25px;
    padding: 10px;
    scrollbar-width: none;
  }
  .carousel-container::-webkit-scrollbar { display: none; }
  .carousel-btn {
    background: #ffb84d;
    border: none;
    color: white;
    font-size: 24px;
    padding: 10px 15px;
    border-radius: 50%;
    cursor: pointer;
    transition: 0.3s;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  }
  .carousel-btn:hover {
    background: #ff9800;
    transform: scale(1.1);
  }
  .left { position: absolute; left: -45px; }
  .right { position: absolute; right: -45px; }

  /* ====== CARD ====== */
  .event-card {
    flex: 0 0 280px;
    background: #fffef7;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    padding: 18px;
    text-align: left;
    border: 1.5px solid #ffe082;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 380px;
  }
  .event-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.15);
  }
  .event-card img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 12px;
    margin-bottom: 12px;
  }
  .edit-btn {
    align-self: flex-start;
    margin-top: auto;
    background: linear-gradient(135deg, #ffb84d, #ff9800);
    color: white;
    font-weight: 600;
    padding: 10px 16px;
    border-radius: 8px;
    text-decoration: none;
    transition: 0.3s;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }
  .edit-btn:hover {
    background: linear-gradient(135deg, #ffa726, #fb8c00);
    transform: translateY(-2px);
  }
  </style>

  <script>
  function scrollLeft() {
    document.getElementById('myEventsCarousel').scrollBy({ left: -300, behavior: 'smooth' });
  }
  function scrollRight() {
    document.getElementById('myEventsCarousel').scrollBy({ left: 300, behavior: 'smooth' });
  }
  </script>

  <!-- üåç DANH S√ÅCH S·ª∞ KI·ªÜN -->
  <section class="community-events">
    <h3>üåç Danh s√°ch s·ª± ki·ªán</h3>

    {% if request.GET.success %}
      <div id="flash-message" class="flash-message success">‚úÖ B·∫°n ƒë√£ ƒëƒÉng k√Ω tham gia s·ª± ki·ªán th√†nh c√¥ng!</div>
    {% elif request.GET.cancel %}
      <div id="flash-message" class="flash-message warning">‚ùå B·∫°n ƒë√£ h·ªßy ƒëƒÉng k√Ω s·ª± ki·ªán th√†nh c√¥ng!</div>
    {% endif %}

    {% if danh_sach_su_kien %}
    <div class="event-grid">
     {% for e in danh_sach_su_kien %}
        <div class="event-card">
            {% if e.image %}
                <img src="{{ e.image.url }}" alt="{{ e.title }}">
            {% endif %}

            <h4>{{ e.title }}</h4>
            <p class="creator">üë§ T·∫°o b·ªüi: <strong>{{ e.creator.username }}</strong></p>

            <p>{{ e.description|truncatechars:80 }}</p>
            <p><strong>üìç ƒê·ªãa ƒëi·ªÉm:</strong> {{ e.location }}</p>
            <p><strong>üïì Th·ªùi gian:</strong> {{ e.date|date:"d/m/Y H:i" }}</p>


        {% if e.creator == user %}
            <a href="{% url 'danh_sach_nguoi_dang_ky' e.id %}" class="view-btn">üë• Xem danh s√°ch ng∆∞·ªùi ƒëƒÉng k√Ω</a>
        {% elif user in e.participants.all %}
            <a href="{% url 'huy_dang_ky_tham_gia' e.id %}" class="cancel-btn">‚ùå H·ªßy ƒëƒÉng k√Ω</a>
        {% else %}
            <a href="{% url 'dang_ky_tham_gia' e.id %}" class="join-btn">üêæ ƒêƒÉng k√Ω tham gia</a>
        {% endif %}

      </div>
      {% endfor %}
    </div>
    {% else %}
      <p>Ch∆∞a c√≥ s·ª± ki·ªán n√†o ƒë∆∞·ª£c ph√™ duy·ªát.</p>
    {% endif %}
  </section>

  <script>
  setTimeout(() => {
    const msg = document.getElementById("flash-message");
    if (msg) msg.style.display = "none";
  }, 3500);
  </script>

  <style>
    .flash-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #4caf50;
      color: white;
      padding: 14px 28px;
      border-radius: 10px;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      z-index: 1000;
      animation: fadeInOut 3.5s ease forwards;
      text-align: center;
      min-width: 360px;
    }
    .flash-message.warning { background: #ff9800; }
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translate(-50%, -60%); }
      10%, 90% { opacity: 1; transform: translate(-50%, -50%); }
      100% { opacity: 0; transform: translate(-50%, -40%); }
    }
  </style>

</div>

<style>

.event-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 2fr));
  gap: 16px;
  margin-top: 10px;
}
.event-card {
  background: #fff;
  border-radius: 12px;
  padding: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  transition: 0.3s;
}
.event-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
.join-btn {
  display: inline-block;
  background: #003459;
  color: #fff;
  padding: 6px 10px;
  border-radius: 8px;
  text-decoration: none;
  font-size: 14px;
}
.join-btn:hover { background: #0056a3; }
.cancel-btn {
  display: inline-block;
  background: linear-gradient(135deg, #ff6b6b, #ff4757);
  color: #fff;
  padding: 7px 14px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  text-decoration: none;
  border: none;
  transition: all 0.25s ease;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}
.cancel-btn:hover {
  background: linear-gradient(135deg, #ff4757, #e84118);
  transform: translateY(-2px);
  box-shadow: 0 5px 12px rgba(0,0,0,0.25);
}
.create-event-wrapper {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 10px;
  margin-right: 15px;
}
.create-event-btn {
  background: linear-gradient(135deg, #4CAF50, #2E7D32);
  color: white;
  font-weight: 600;
  padding: 10px 18px;
  border-radius: 10px;
  text-decoration: none;
  transition: 0.3s;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
}
.create-event-btn:hover {
  background: linear-gradient(135deg, #43A047, #1B5E20);
  transform: translateY(-2px);
}
</style>
<style>
.creator {
  font-size: 14px;
  color: #444;
  margin-bottom: 6px;
}
.creator strong {
  color: #003459;
  font-weight: 600;
}
</style>

<style>
.join-btn, .view-btn {
  display: inline-block;
  background: #003459;
  color: #fff;
  padding: 8px 14px;
  border-radius: 8px;
  text-decoration: none;
  font-size: 14px;
  font-weight: 600;
  transition: 0.25s;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  width: fit-content; /* ‚úÖ n√∫t t·ª± co theo ƒë·ªô d√†i ch·ªØ */
}

.join-btn:hover, .view-btn:hover {
  background: #0056a3;
  transform: translateY(-2px);
}

.view-btn {
  background: linear-gradient(135deg, #6ba6ff, #1e88e5);
}

.view-btn:hover {
  background: linear-gradient(135deg, #4a90e2, #1565c0);
}
</style>

<style>
.event-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: auto;
}
</style>

{% endblock %}
